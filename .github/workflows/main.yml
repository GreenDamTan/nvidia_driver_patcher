name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-20.04
    container:
      image: ubuntu:focal-20240530
      volumes:
        - /home/runner:/home/runner
      env:
        DOTNET_ROOT: /usr/share/dotnet
        DEBIAN_FRONTEND: noninteractive
        TZ: Asia/Shanghai
      options:
        --user root
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
          cat /etc/os-release
          pwd
          ls -l
      - run: echo "🍏 This job's status is ${{ job.status }}."
      - name: apt install
        run: |
          apt-get update
          ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
          apt-get install aptitude wget curl sudo p7zip-full busybox bsdmainutils xxd xvfb ca-certificates -y --no-install-recommends
          sudo busybox --install
      - name: Install dotnet dependencies
        run: |
          #wget --no-check-certificate https://dotnet.microsoft.com/download/dotnet/scripts/v1/dotnet-install.sh -O dotnet-install.sh
          #chmod +x ./dotnet-install.sh
          #sudo ./dotnet-install.sh --runtime dotnet --channel 9.0 --quality preview --install-dir /usr/share/dotnet
          #echo 'export DOTNET_ROOT=/usr/share/dotnet' >> /etc/profileecho
          #export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools' >> /etc/profile
          #. /etc/profile
          wget --no-check-certificate https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
          dpkg -i packages-microsoft-prod.deb
          rm packages-microsoft-prod.deb
          apt-get update
          apt-get install -y dotnet-runtime-8.0
          dotnet --list-runtimes
      - name: add wine keys
        run: |
          #sudo dpkg --add-architecture i386
          #sudo mkdir -pm755 /etc/apt/keyrings
          #sudo wget -O /etc/apt/keyrings/winehq-archive.key https://dl.winehq.org/wine-builds/winehq.key
          #sudo wget -NP /etc/apt/sources.list.d/ https://dl.winehq.org/wine-builds/ubuntu/dists/focal/winehq-focal.sources
          #sudo apt-get update
          echo "none"
      - name: Install wine apt
        run: |
          #apt install --install-recommends winehq-stable winetricks -y -f
          #Xvfb :0 -screen 0 1024x768x16 &
          #export DISPLAY=:0.0
          echo "none"
      - name: Install jsign
        run: |
          wget https://github.com/ebourg/jsign/releases/download/6.0/jsign_6.0_all.deb -O jsign_6.0_all.deb
          apt install -y ./jsign_6.0_all.deb
      - name: Install apt dependencies
        run: |
          sudo apt-get update
          sudo apt-get install --install-recommends -y osslsigncode mscompress rename
      - name: Install patch.sh
        run: |
          chmod +x patch.sh
          ./patch.sh
      - name: Upload artifact
        uses: actions/upload-artifact@master
        with:
            name: driver
            path: /home/runner/work/nvidia_driver_patcher/nvidia_driver_patcher
            retention-days: 1
      - name: Upload artifact nvlddmkm.sys
        uses: actions/upload-artifact@master
        with:
          name: nvlddmkm.sys
          path: /home/runner/work/nvidia_driver_patcher/nvidia_driver_patcher/560.94-desktop-win10-win11-64bit-international-dch-whql/Display.Driver/nvlddmkm.sys
          retention-days: 1
      - name: Upload artifact nv_disp.cat
        uses: actions/upload-artifact@master
        with:
          name: nv_disp.cat
          path: /home/runner/work/nvidia_driver_patcher/nvidia_driver_patcher/560.94-desktop-win10-win11-64bit-international-dch-whql/Display.Driver/nv_disp.cat
          retention-days: 1